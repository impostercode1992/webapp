<div class="w3-bar-item w3-button w3-right">
  <button onclick="document.getElementById('authModal').style.display='block'">Account</button>
</div>
<div id="authModal" class="w3-modal">
  <div class="w3-modal-content w3-card-4" style="max-width: 420px">
    <span onclick="document.getElementById('msi').style.display='none'"
      class="w3-button w3-xlarge w3-hover-red w3-display-topright" title="Close Modal">&times;</span>
    <?php include "nlink.html";?>
  </div>
</div>



<script src="https://accounts.google.com/gsi/client" async defer></script>

<script>
  function authFunc(evt, authName) {
    var i, x, tablinks;
    x = document.getElementsByClassName("form");
    for (i = 0; i < x.length; i++) {
      x[i].style.display = "none";
    }
    tablinks = document.getElementsByClassName("tablink");
    for (i = 0; i < x.length; i++) {
      tablinks[i].className = tablinks[i].className.replace(" w3-red", "");
    }
    document.getElementById(authName).style.display = "block";
    evt.currentTarget.className += " w3-red";
  }

  // Callback function for handling the Google credential response
  function handleCredentialResponse(response) {
    // Decode the JWT token to get user data
    const responsePayload = decodeJwtResponse(response.credential);

    // Log the payload to the console for inspection
    console.log("ID: " + responsePayload.sub);
    console.log("Full Name: " + responsePayload.name);
    console.log("Image URL: " + responsePayload.picture);
    console.log("Email: " + responsePayload.email);

    // Display the user profile
    document.getElementById('profile-name').innerText = responsePayload.name;
    document.getElementById('profile-email').innerText = responsePayload.email;
    document.getElementById('profile-pic').src = responsePayload.picture;

    // Hide the sign-in button and show the profile card
    document.getElementById('authModal').style.display = 'none';
    document.querySelector('.g_id_signin').style.display = 'none';
    document.getElementById('authShow').style.display = 'block';
    document.getElementById('authHide').style.display = 'none';
  }

  // Helper function to decode the JWT token
  function decodeJwtResponse(token) {
    let base64Url = token.split('.')[1];
    let base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    let jsonPayload = decodeURIComponent(atob(base64).split('').map(function (c) {
      return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
    }).join(''));
    return JSON.parse(jsonPayload);
  }

  // Function to sign out the user
  function signOut() {
    // Use Google's API to sign out
    google.accounts.id.disableAutoSelect(); // Prevents One Tap from re-displaying immediately

    // Reset the UI
    document.querySelector('.g_id_signin').style.display = 'block';
    document.getElementById('authHide').style.display = 'block';
    document.getElementById('authShow').style.display = 'none';
  }
</script>